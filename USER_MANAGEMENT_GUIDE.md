# 用户管理功能使用指南

## 功能概述

系统新增了完整的用户管理功能，允许 **ADMIN** 和 **HR** 角色创建、编辑和管理用户账号。

## 访问权限

- **权限要求**：ADMIN 或 HR 角色
- **访问路径**：登录后在左侧菜单点击"用户管理"

## 功能说明

### 1. 用户列表

- **查看用户**：显示所有用户的基本信息
  - ID、姓名、邮箱、工号、手机号
  - 所属部门
  - 角色（可多个）
  - 状态（激活/停用/离职）
  - 创建时间

- **搜索功能**：支持按姓名、邮箱、工号、手机号搜索

- **分页功能**：支持 10/20/50/100 条/页

### 2. 创建用户

点击"创建用户"按钮，填写以下信息：

#### 必填项
- **姓名**：用户真实姓名
- **邮箱**：用于登录的邮箱地址（必须唯一）
- **密码**：至少 6 位
- **角色**：至少选择一个角色
  - EMPLOYEE：普通员工
  - MANAGER：主管（可审批）
  - HR：人力资源
  - ADMIN：系统管理员

#### 可选项
- **工号**：员工工号（如果填写必须唯一）
- **手机号**：联系电话（如果填写必须唯一）
- **部门**：所属部门
- **状态**：激活/停用（默认激活）

### 3. 编辑用户

点击用户列表中的"编辑"按钮，可以修改：

- 基本信息（姓名、邮箱、工号、手机号）
- 密码（留空则不修改）
- 部门
- 角色
- 状态（激活/停用/离职）

### 4. 删除用户

点击"删除"按钮，用户状态将变为"离职"（软删除）。

**注意**：删除操作不会真正删除数据，只是将用户状态设置为离职，该用户将无法登录系统。

## 使用示例

### 示例 1：创建普通员工

1. 点击"创建用户"
2. 填写信息：
   - 姓名：张三
   - 邮箱：zhangsan@company.com
   - 密码：123456
   - 工号：E001
   - 部门：技术部
   - 角色：EMPLOYEE
   - 状态：激活
3. 点击"确定"

### 示例 2：创建主管

1. 点击"创建用户"
2. 填写信息：
   - 姓名：李经理
   - 邮箱：limanager@company.com
   - 密码：123456
   - 部门：技术部
   - 角色：EMPLOYEE, MANAGER（可多选）
   - 状态：激活
3. 点击"确定"

### 示例 3：修改用户部门

1. 在用户列表找到目标用户
2. 点击"编辑"
3. 修改部门为新部门
4. 点击"确定"

### 示例 4：重置用户密码

1. 在用户列表找到目标用户
2. 点击"编辑"
3. 在密码框输入新密码
4. 点击"确定"

## API 接口

### 获取用户列表
```
GET /admin/users?page=1&pageSize=20&keyword=张三
```

### 创建用户
```
POST /admin/users
{
  "email": "user@example.com",
  "password": "123456",
  "fullName": "张三",
  "employeeNo": "E001",
  "phone": "13800138000",
  "departmentId": 1,
  "roles": ["EMPLOYEE"],
  "status": "ACTIVE"
}
```

### 更新用户
```
PUT /admin/users/:id
{
  "fullName": "张三",
  "departmentId": 2,
  "roles": ["EMPLOYEE", "MANAGER"],
  "status": "ACTIVE"
}
```

### 删除用户
```
DELETE /admin/users/:id
```

### 获取部门列表
```
GET /admin/departments
```

### 获取角色列表
```
GET /admin/roles
```

## 注意事项

1. **邮箱唯一性**：同一组织内邮箱不能重复
2. **工号唯一性**：如果设置工号，同一组织内工号不能重复
3. **手机号唯一性**：如果设置手机号，同一组织内手机号不能重复
4. **密码安全**：密码至少 6 位，建议使用强密码
5. **角色权限**：
   - EMPLOYEE：基础权限
   - MANAGER：可审批下属申请
   - HR：可管理用户、查看全员数据
   - ADMIN：拥有所有权限
6. **删除限制**：删除用户是软删除，不会真正删除数据

## 测试步骤

### 使用 Admin 账号测试

1. **登录系统**
   ```
   邮箱：admin@test.com
   密码：123456
   ```

2. **访问用户管理**
   - 点击左侧菜单"用户管理"

3. **创建测试用户**
   - 点击"创建用户"
   - 填写测试信息
   - 提交

4. **编辑用户**
   - 找到刚创建的用户
   - 点击"编辑"
   - 修改信息
   - 提交

5. **搜索用户**
   - 在搜索框输入关键词
   - 按回车或点击搜索按钮

6. **删除用户**
   - 点击"删除"
   - 确认删除

7. **使用新账号登录**
   - 退出当前账号
   - 使用新创建的账号登录
   - 验证功能是否正常

## 常见问题

### Q1: 为什么看不到"用户管理"菜单？
A: 只有 ADMIN 和 HR 角色才能看到此菜单。请确认您的账号拥有相应权限。

### Q2: 创建用户时提示"邮箱已被使用"？
A: 同一组织内邮箱必须唯一。请使用其他邮箱地址。

### Q3: 删除用户后能恢复吗？
A: 可以。删除是软删除，只是将状态改为"离职"。可以通过编辑用户，将状态改回"激活"来恢复。

### Q4: 如何批量创建用户？
A: 目前不支持批量创建。如有需要，可以使用 API 接口编写脚本批量创建。

### Q5: 用户忘记密码怎么办？
A: 管理员可以通过编辑用户功能重置密码。

## 开发信息

### 后端文件
- Service: `backend/src/services/user.service.ts`
- Controller: `backend/src/controllers/user.controller.ts`
- Routes: `backend/src/routes/user.routes.ts`
- Validator: `backend/src/validators/user.ts`

### 前端文件
- Page: `frontend/src/views/UserManage.vue`
- Router: `frontend/src/router/index.ts`
- API Config: `frontend/src/config/api.ts`

---

**版本**: 1.0.0  
**最后更新**: 2025-01-07

